'use client'
import { effect } from '@vue/reactivity';
import { Logger } from '@dynamic-labs/logger';
import { version } from '../../../package.js';

const setupInstrumentationModule = (clientProps) => {
    var _a;
    Logger.setEnvironmentId(clientProps.environmentId);
    Logger.globalMetaData.set('platform-origin', 'host');
    Logger.globalMetaData.set('client-version', version);
    Logger.globalMetaData.set('app-name', clientProps.appName);
    if (((_a = clientProps.debug) === null || _a === void 0 ? void 0 : _a.loggerLevel) !== undefined) {
        Logger.setLogLevel(clientProps.debug.loggerLevel);
    }
    return {
        trackClient: (client) => {
            client.sdk.on('loadedChanged', (loaded) => {
                Logger.globalMetaData.set('sdk-loaded', loaded);
            });
            client.auth.on('authenticatedUserChanged', (user) => {
                Logger.globalMetaData.set('user-id', user === null || user === void 0 ? void 0 : user.userId);
            });
        },
        trackCore: (core) => {
            effect(() => {
                Logger.globalMetaData.set('declared-extension-names', core.declaredExtensionNames);
            });
            effect(() => {
                var _a;
                Logger.globalMetaData.set('initialization-error', (_a = core.initialization.error) === null || _a === void 0 ? void 0 : _a.toString());
            });
        },
    };
};

export { setupInstrumentationModule };
